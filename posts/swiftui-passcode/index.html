<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Passcodeview made with SwiftUI | Marginals LLC.</title>
<meta name=keywords content="SwiftUI"><meta name=description content="Source Code https://github.com/mitolog/SwiftUI-Passcode
Motivation On one of my client&rsquo;s project, I need to prepare passcode view that works independent of touch ID or face ID.
Moreover, the project is totally craeted by SwiftUI, so I was looking for some libraries or samples that is written in SwiftUI and meets the functionality needed. But I couldn&rsquo;t find appropriate one. So, I needed to implement by myself.
The Functionality When an user returned to the app after locking the window or closing the app with pushing the home button, the app always needs to show the passcode view."><meta name=author content="mito"><link rel=canonical href=https://canonical.url/to/page><link crossorigin=anonymous href=/assets/css/stylesheet.min.018cab30f0ada6d4f0a0ff8141e7cfadfc2da980910798cb4ef4ba22d5986599.css integrity="sha256-AYyrMPCtptTwoP+BQefPrfwtqYCRB5jLTvS6ItWYZZk=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.30d2332871da51f600f574811c17751e6c862577d450b624f86e2bc8a6e31221.js integrity="sha256-MNIzKHHaUfYA9XSBHBd1HmyGJXfUULYk+G4ryKbjEiE=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://marginals.jp/marginals_favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://marginals.jp/favicon16.ico><link rel=icon type=image/png sizes=32x32 href=https://marginals.jp/favicon32.ico><link rel=apple-touch-icon href=https://marginals.jp/apple_touch_icon.png><link rel=mask-icon href=https://marginals.jp/safari_pinned_tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=ja href=https://marginals.jp/ja/posts/swiftui-passcode/><link rel=alternate hreflang=en href=https://marginals.jp/posts/swiftui-passcode/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-BMKDJ4JTQZ"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-BMKDJ4JTQZ",{anonymize_ip:!1})}</script><meta property="og:title" content="Passcodeview made with SwiftUI"><meta property="og:description" content="Source Code https://github.com/mitolog/SwiftUI-Passcode
Motivation On one of my client&rsquo;s project, I need to prepare passcode view that works independent of touch ID or face ID.
Moreover, the project is totally craeted by SwiftUI, so I was looking for some libraries or samples that is written in SwiftUI and meets the functionality needed. But I couldn&rsquo;t find appropriate one. So, I needed to implement by myself.
The Functionality When an user returned to the app after locking the window or closing the app with pushing the home button, the app always needs to show the passcode view."><meta property="og:type" content="article"><meta property="og:url" content="https://marginals.jp/posts/swiftui-passcode/"><meta property="og:image" content="https://marginals.jp/%3Cimage%20path/url%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-03-15T00:00:03+09:00"><meta property="article:modified_time" content="2021-03-15T00:00:03+09:00"><meta property="og:site_name" content="Marginals LLC."><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://marginals.jp/%3Cimage%20path/url%3E"><meta name=twitter:title content="Passcodeview made with SwiftUI"><meta name=twitter:description content="Source Code https://github.com/mitolog/SwiftUI-Passcode
Motivation On one of my client&rsquo;s project, I need to prepare passcode view that works independent of touch ID or face ID.
Moreover, the project is totally craeted by SwiftUI, so I was looking for some libraries or samples that is written in SwiftUI and meets the functionality needed. But I couldn&rsquo;t find appropriate one. So, I needed to implement by myself.
The Functionality When an user returned to the app after locking the window or closing the app with pushing the home button, the app always needs to show the passcode view."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://marginals.jp/posts/"},{"@type":"ListItem","position":3,"name":"Passcodeview made with SwiftUI","item":"https://marginals.jp/posts/swiftui-passcode/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Passcodeview made with SwiftUI","name":"Passcodeview made with SwiftUI","description":"Source Code https://github.com/mitolog/SwiftUI-Passcode\nMotivation On one of my client\u0026rsquo;s project, I need to prepare passcode view that works independent of touch ID or face ID.\nMoreover, the project is totally craeted by SwiftUI, so I was looking for some libraries or samples that is written in SwiftUI and meets the functionality needed. But I couldn\u0026rsquo;t find appropriate one. So, I needed to implement by myself.\nThe Functionality When an user returned to the app after locking the window or closing the app with pushing the home button, the app always needs to show the passcode view.","keywords":["SwiftUI"],"articleBody":"Source Code https://github.com/mitolog/SwiftUI-Passcode\nMotivation On one of my client’s project, I need to prepare passcode view that works independent of touch ID or face ID.\nMoreover, the project is totally craeted by SwiftUI, so I was looking for some libraries or samples that is written in SwiftUI and meets the functionality needed. But I couldn’t find appropriate one. So, I needed to implement by myself.\nThe Functionality When an user returned to the app after locking the window or closing the app with pushing the home button, the app always needs to show the passcode view. An user can unlock the passcode view by choosing numbers from 0 to 9 with pre-defined digits. When a user fails to unlock, the shake animation is executed and resets the numbers a user has input. You can set fonts and colors when init You can check how it works by the gif below:\nHow it works The UI aspects The core UI consists of these files:\nPasscodeField.swift LegacyTextField.swift ShakeAnimation.swift located under the Passcode folder.\nPasscodeField is the main view and its made with SwiftUI and Combine.\nThe key points that I’d like to mention are:\n1. The cusor and hideen letter imitation Because the passcode view itself is not using TextInputView, I need to imitate the cusor blinking and need to make the letter hidden some milliseconds after the user’s input. I ended up learning that where to put the .animation is the key not to animate the properties that you don’t want to.\n2. Toggle the keyboard LegacyTextField is used behind the SwiftUI because I need to toggle keyboard on show.\nI basically referred articles via stackoverflow and hackingwithswift.\nI think you should better to use @FocusState if the target OS is over iOS 15.\n3. Shake animation I have no idea to achieve shake animation by myself, so I reffered stack overflow.\nThen, to achieve reset function after shakeanimation, I utilised onAnimationCompleted callback as written on ANTOINE VAN DER LEE’s article.\nThe Window handling I tried…\n.fullScreenCover Custom View(Struct) where you can use passcode view like GeometryReader{ proxy in ... } But, I found that controlling Window has less affection towards existing code base and works smoother than the owther methods. So, I adopt layered Window methods.\nThanks to the article: How to layer multiple windows in SwiftUI by @zntfdr, I could implement layered window. I really appreciated.\nAnyways, you can find how window works on these files:\nSceneDelegate.swift PassThroughWindow.swift located here https://github.com/mitolog/SwiftUI-Passcode/tree/main/PasscodeSample .\nThe key concept is like this:\nBasically we put PassThroughWindow in front of the main window. If you want to hide the Passcode, set the background color clear so that you can see the view behind it which is the main window’s view.\nSo, how we can pass the touch event to the main window? We can achieve it like this:\nclass PassThroughWindow: UIWindow { override func hitTest(_ point: CGPoint, with event: UIEvent?) -\u003e UIView? { guard let hitView = super.hitTest(point, with: event) else { return nil } return rootViewController?.view == hitView ? nil : hitView } } PassThroughWindow is the window that PasscodeView is on.\nIf we returns nil here, The PassThroughWindow declares this touch event doesn’t relevalent to the view underneath. So, the event will be passed to the next window which is the main window.\nTo say it more concretely, we can attain hitView as follows…\nWhen Passcode is shown, hitView would be certain view under the PasscodeView When Passcode is hidden, hitView would be a rootView, where you set it as clear background, of the PasscodeView So, it would work as you expected as a result.\nThe State handling Within the sample, I don’t sync the state among windows. But, You can sync by using let appState = Store(AppState()) defined on SceneDelegate.swift where you can deal the appState as a single source of truth.\nYou can refer actual state handling via https://github.com/nalexn/clean-architecture-swiftui that I use it on the project ongoing.\nNext step… If there are some comments or needs, I’d like to\nwrite some tests register SwiftPackages If you have any comments or think it useful, please add a star on https://github.com/mitolog/SwiftUI-Passcode !\n","wordCount":"690","inLanguage":"en","image":"https://marginals.jp/%3Cimage%20path/url%3E","datePublished":"2021-03-15T00:00:03+09:00","dateModified":"2021-03-15T00:00:03+09:00","author":{"@type":"Person","name":"mito"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://marginals.jp/posts/swiftui-passcode/"},"publisher":{"@type":"Organization","name":"Marginals LLC.","logo":{"@type":"ImageObject","url":"https://marginals.jp/marginals_favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://marginals.jp accesskey=h title="  (Alt + H)"><img src=https://marginals.jp/apple_touch_icon.png alt=logo aria-label=logo height=35></a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://marginals.jp/ja/ title=Ja aria-label=Ja>Ja</a></li></ul></div></div><ul id=menu><li><a href=https://marginals.jp/categories/ title=categories><span>categories</span></a></li><li><a href=https://marginals.jp/tags/ title=tags><span>tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://marginals.jp>Home</a>&nbsp;»&nbsp;<a href=https://marginals.jp/posts/>Posts</a></div><h1 class=post-title>Passcodeview made with SwiftUI</h1><div class=post-meta>&lt;span title='2021-03-15 00:00:03 +0900 +0900'>March 15, 2021&lt;/span>&amp;nbsp;·&amp;nbsp;mito&nbsp;|&nbsp;Translations:<ul class=i18n_list><li><a href=https://marginals.jp/ja/posts/swiftui-passcode/>Ja</a></li></ul>&nbsp;|&nbsp;<a href=https://github.com/mitolog/mitolog.github.io/tree/main/content/posts/swiftui-passcode.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#source-code aria-label="Source Code">Source Code</a></li><li><a href=#motivation aria-label=Motivation>Motivation</a></li><li><a href=#the-functionality aria-label="The Functionality">The Functionality</a></li><li><a href=#how-it-works aria-label="How it works">How it works</a><ul><li><a href=#the-ui-aspects aria-label="The UI aspects">The UI aspects</a><ul><li><a href=#1-the-cusor-and-hideen-letter-imitation aria-label="1. The cusor and hideen letter imitation">1. The cusor and hideen letter imitation</a></li><li><a href=#2-toggle-the-keyboard aria-label="2. Toggle the keyboard">2. Toggle the keyboard</a></li><li><a href=#3-shake-animation aria-label="3. Shake animation">3. Shake animation</a></li></ul></li><li><a href=#the-window-handling aria-label="The Window handling">The Window handling</a></li><li><a href=#the-state-handling aria-label="The State handling">The State handling</a></li></ul></li><li><a href=#next-step aria-label="Next step&amp;hellip;">Next step&mldr;</a></li></ul></div></details></div><div class=post-content><h2 id=source-code>Source Code<a hidden class=anchor aria-hidden=true href=#source-code>#</a></h2><p><a href=https://github.com/mitolog/SwiftUI-Passcode>https://github.com/mitolog/SwiftUI-Passcode</a></p><h2 id=motivation>Motivation<a hidden class=anchor aria-hidden=true href=#motivation>#</a></h2><p>On one of my client&rsquo;s project, I need to prepare passcode view that works independent of touch ID or face ID.</p><p>Moreover, the project is totally craeted by SwiftUI, so I was looking for some libraries or samples that is written in SwiftUI and meets the functionality needed. But I couldn&rsquo;t find appropriate one. So, I needed to implement by myself.</p><h2 id=the-functionality>The Functionality<a hidden class=anchor aria-hidden=true href=#the-functionality>#</a></h2><ul><li>When an user returned to the app after locking the window or closing the app with pushing the home button, the app always needs to show the passcode view.</li><li>An user can unlock the passcode view by choosing numbers from 0 to 9 with pre-defined digits.</li><li>When a user fails to unlock, the shake animation is executed and resets the numbers a user has input.</li><li>You can set fonts and colors when init</li></ul><p>You can check how it works by the gif below:</p><p><img loading=lazy src=https://raw.githubusercontent.com/wiki/mitolog/SwiftUI-Passcode/images/SwiftUI-Passcode.gif alt></p><h2 id=how-it-works>How it works<a hidden class=anchor aria-hidden=true href=#how-it-works>#</a></h2><hr><h3 id=the-ui-aspects>The UI aspects<a hidden class=anchor aria-hidden=true href=#the-ui-aspects>#</a></h3><p>The core UI consists of these files:</p><ul><li>PasscodeField.swift</li><li>LegacyTextField.swift</li><li>ShakeAnimation.swift</li></ul><p>located under the <a href=https://github.com/mitolog/SwiftUI-Passcode/tree/main/PasscodeSample/Passcode>Passcode folder</a>.</p><p><code>PasscodeField</code> is the main view and its made with SwiftUI and Combine.</p><p>The key points that I&rsquo;d like to mention are:</p><h4 id=1-the-cusor-and-hideen-letter-imitation>1. The cusor and hideen letter imitation<a hidden class=anchor aria-hidden=true href=#1-the-cusor-and-hideen-letter-imitation>#</a></h4><p>Because the passcode view itself is not using TextInputView, I need to imitate the cusor blinking and need to make the letter hidden some milliseconds after the user&rsquo;s input. I ended up learning that where to put the <code>.animation</code> is the key not to animate the properties that you don&rsquo;t want to.</p><h4 id=2-toggle-the-keyboard>2. Toggle the keyboard<a hidden class=anchor aria-hidden=true href=#2-toggle-the-keyboard>#</a></h4><p>LegacyTextField is used behind the SwiftUI because I need to toggle keyboard on show.</p><p>I basically referred articles via <a href=https://stackoverflow.com/questions/56507839/swiftui-how-to-make-textfield-become-first-responder>stackoverflow</a> and <a href=https://www.hackingwithswift.com/example-code/uikit/how-to-limit-the-number-of-characters-in-a-uitextfield-or-uitextview>hackingwithswift</a>.</p><p>I think you should better to use <code>@FocusState</code> if the target OS is over iOS 15.</p><h4 id=3-shake-animation>3. Shake animation<a hidden class=anchor aria-hidden=true href=#3-shake-animation>#</a></h4><p>I have no idea to achieve shake animation by myself, so I reffered <a href=https://stackoverflow.com/questions/61619013/is-there-a-better-way-to-implement-a-shake-animation-in-swiftui>stack overflow</a>.</p><p>Then, to achieve reset function after shakeanimation, I utilised <code>onAnimationCompleted</code> callback as written on <a href=https://www.avanderlee.com/swiftui/withanimation-completion-callback/>ANTOINE VAN DER LEE&rsquo;s article</a>.</p><hr><h3 id=the-window-handling>The Window handling<a hidden class=anchor aria-hidden=true href=#the-window-handling>#</a></h3><p>I tried&mldr;</p><ul><li><code>.fullScreenCover</code></li><li>Custom View(Struct) where you can use passcode view like <code>GeometryReader{ proxy in ... }</code></li></ul><p>But, I found that controlling <code>Window</code> has less affection towards existing code base and works smoother than the owther methods. So, I adopt layered Window methods.</p><p>Thanks to the article: <a href=https://www.fivestars.blog/articles/swiftui-windows/>How to layer multiple windows in SwiftUI</a> by <a href=https://twitter.com/zntfdr>@zntfdr</a>, I could implement layered window. I really appreciated.</p><p>Anyways, you can find how window works on these files:</p><ul><li>SceneDelegate.swift</li><li>PassThroughWindow.swift</li></ul><p>located here <a href=https://github.com/mitolog/SwiftUI-Passcode/tree/main/PasscodeSample>https://github.com/mitolog/SwiftUI-Passcode/tree/main/PasscodeSample</a> .</p><p>The key concept is like this:</p><p>Basically we put <code>PassThroughWindow</code> in front of the main window.
If you want to hide the Passcode, set the background color <code>clear</code> so that you can see the view behind it which is the main window&rsquo;s view.</p><p>So, how we can pass the touch event to the main window? We can achieve it like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PassThroughWindow</span>: UIWindow {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>hitTest</span>(<span style=color:#66d9ef>_</span> point: CGPoint, with event: UIEvent?) -&gt; UIView? {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>guard</span> <span style=color:#66d9ef>let</span> hitView = <span style=color:#66d9ef>super</span>.hitTest(point, with: event) <span style=color:#66d9ef>else</span> { <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span> }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> rootViewController?.view == hitView ? <span style=color:#66d9ef>nil</span> : hitView
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>PassThroughWindow is the window that PasscodeView is on.</p><p>If we returns <code>nil</code> here, The PassThroughWindow declares this touch event doesn&rsquo;t relevalent to the view underneath.
So, the event will be passed to the next window which is the main window.</p><p>To say it more concretely, we can attain hitView as follows&mldr;</p><ul><li>When Passcode is shown, hitView would be certain view under the PasscodeView</li><li>When Passcode is hidden, hitView would be a rootView, where you set it as clear background, of the PasscodeView</li></ul><p>So, it would work as you expected as a result.</p><hr><h3 id=the-state-handling>The State handling<a hidden class=anchor aria-hidden=true href=#the-state-handling>#</a></h3><p>Within the sample, I don&rsquo;t sync the state among windows. But, You can sync by using <code>let appState = Store&lt;AppState>(AppState())</code> defined on SceneDelegate.swift where you can deal the appState as a single source of truth.</p><p>You can refer actual state handling via <a href=https://github.com/nalexn/clean-architecture-swiftui>https://github.com/nalexn/clean-architecture-swiftui</a> that I use it on the project ongoing.</p><h2 id=next-step>Next step&mldr;<a hidden class=anchor aria-hidden=true href=#next-step>#</a></h2><p>If there are some comments or needs, I&rsquo;d like to</p><ul><li>write some tests</li><li>register SwiftPackages</li></ul><p>If you have any comments or think it useful, please add a star on <a href=https://github.com/mitolog/SwiftUI-Passcode>https://github.com/mitolog/SwiftUI-Passcode</a> !</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://marginals.jp/tags/swiftui/>SwiftUI</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://marginals.jp>Marginals LLC.</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>